<!DOCTYPE html>
<html lang="es" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AutoResponder WhatsApp - Automatiza tus respuestas</title>
  <style>
    /* Variables de tema */
    :root {
      --bg-primary: #f6f8fa;
      --bg-secondary: #fff;
      --bg-tertiary: #f8fafe;
      --border-primary: #e4dbfa;
      --border-secondary: #dad2ee;
      --text-primary: #292340;
      --text-secondary: #3d3663;
      --text-accent: #5a40c6;
      --input-bg: #fafaff;
      --shadow-light: #decaf820;
      --success: #10b981;
      --danger: #ef4444;
      --warning: #f59e0b;
    }

    [data-theme="dark"] {
      --bg-primary: #1e1e1e;
      --bg-secondary: #252526;
      --bg-tertiary: #2d2d30;
      --border-primary: #3e3e42;
      --border-secondary: #464647;
      --text-primary: #cccccc;
      --text-secondary: #c5c5c5;
      --text-accent: #569cd6;
      --input-bg: #3c3c3c;
      --shadow-light: #00000020;
    }

    /* Reset y base */
    * { 
      box-sizing: border-box; 
      margin: 0; 
      padding: 0; 
    }

    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      transition: all 0.3s ease;
    }

    /* Layout principal */
    .container {
      display: flex;
      height: 100vh;
    }

    .sidebar {
      width: 350px;
      background: var(--bg-secondary);
      border-right: 1px solid var(--border-secondary);
      padding: 24px;
      overflow-y: auto;
    }

    .main-content {
      flex: 1;
      background: var(--bg-primary);
      padding: 24px;
      overflow-y: auto;
    }

    /* Header */
    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 32px;
      padding-bottom: 16px;
      border-bottom: 2px solid var(--border-primary);
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo h1 {
      font-size: 1.8rem;
      background: linear-gradient(90deg, #7b4de4, #20b997);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .logo .icon {
      font-size: 2rem;
    }

    /* Bot√≥n de tema */
    .theme-toggle {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      border: 2px solid var(--border-secondary);
      background: var(--bg-secondary);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      box-shadow: 0 4px 12px var(--shadow-light);
      transition: all 0.3s ease;
    }

    .theme-toggle:hover {
      transform: scale(1.1);
    }

    [data-theme="light"] .theme-toggle::before { content: "üåô"; }
    [data-theme="dark"] .theme-toggle::before { content: "‚òÄÔ∏è"; }

    /* Formularios */
    .form-group {
      margin-bottom: 16px;
    }

    .form-row {
      display: flex;
      gap: 16px;
      margin-bottom: 16px;
    }

    .form-row > * {
      flex: 1;
    }

    label {
      display: block;
      font-weight: 600;
      margin-bottom: 6px;
      color: var(--text-secondary);
      font-size: 14px;
    }

    input, textarea, select {
      width: 100%;
      padding: 10px;
      border: 1px solid var(--border-secondary);
      border-radius: 6px;
      background: var(--input-bg);
      color: var(--text-primary);
      font-size: 14px;
      transition: border-color 0.2s ease;
    }

    input:focus, textarea:focus, select:focus {
      outline: none;
      border-color: var(--text-accent);
    }

    textarea {
      resize: vertical;
      min-height: 80px;
      font-family: inherit;
    }

    /* Botones */
    button {
      background: linear-gradient(90deg, #7b4de4, #20b997);
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.2s ease;
    }

    button:hover {
      filter: brightness(1.1);
      transform: translateY(-1px);
    }

    .btn-small {
      padding: 6px 12px;
      font-size: 13px;
      background: #ede6fb;
      color: #4d3497;
      margin-right: 8px;
      margin-bottom: 8px;
    }

    .btn-danger {
      background: var(--danger);
      color: white;
    }

    .btn-success {
      background: var(--success);
      color: white;
    }

    .btn-warning {
      background: var(--warning);
      color: white;
    }

    /* Secciones */
    .section {
      background: var(--bg-secondary);
      border: 1px solid var(--border-secondary);
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px var(--shadow-light);
    }

    .section h3 {
      margin-bottom: 16px;
      color: var(--text-accent);
      font-size: 1.2rem;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    /* Pesta√±as */
    .tabs {
      display: flex;
      background: var(--bg-tertiary);
      border-radius: 8px 8px 0 0;
      border: 1px solid var(--border-secondary);
      margin-bottom: 0;
    }

    .tab {
      flex: 1;
      background: transparent;
      border: none;
      padding: 16px;
      cursor: pointer;
      color: var(--text-secondary);
      transition: all 0.2s ease;
      font-size: 14px;
    }

    .tab.active {
      background: var(--bg-secondary);
      color: var(--text-accent);
      border-bottom: 3px solid var(--text-accent);
      font-weight: 600;
    }

    .tab-content {
      display: none;
      background: var(--bg-secondary);
      border: 1px solid var(--border-secondary);
      border-top: none;
      border-radius: 0 0 8px 8px;
      padding: 24px;
    }

    .tab-content.active {
      display: block;
    }

    /* Estados y indicadores */
    .status-indicator {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 600;
    }

    .status-active {
      background: rgba(16, 185, 129, 0.1);
      color: var(--success);
    }

    .status-inactive {
      background: rgba(239, 68, 68, 0.1);
      color: var(--danger);
    }

    .status-paused {
      background: rgba(245, 158, 11, 0.1);
      color: var(--warning);
    }

    /* Reglas de respuesta */
    .rule-item {
      background: var(--bg-tertiary);
      border: 1px solid var(--border-secondary);
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 12px;
      position: relative;
    }

    .rule-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }

    .rule-title {
      font-weight: 600;
      color: var(--text-primary);
    }

    .rule-controls {
      display: flex;
      gap: 4px;
    }

    .rule-btn {
      background: var(--bg-secondary);
      border: 1px solid var(--border-secondary);
      border-radius: 4px;
      padding: 4px 8px;
      cursor: pointer;
      font-size: 12px;
      color: var(--text-secondary);
    }

    /* Estilos para acciones */
    .action-item {
      background: var(--bg-tertiary);
      border: 1px solid var(--border-secondary);
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 12px;
      position: relative;
    }

    .action-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 12px;
    }

    .action-number {
      background: linear-gradient(90deg, #e3d7fa, #f7c5da);
      color: #8038b6;
      padding: 4px 12px;
      border-radius: 6px;
      font-weight: 700;
      font-size: 14px;
      min-width: 70px;
      text-align: center;
    }

    .action-controls {
      margin-left: auto;
      display: flex;
      gap: 4px;
    }

    .action-btn {
      background: var(--bg-secondary);
      border: 1px solid var(--border-secondary);
      border-radius: 4px;
      padding: 4px 8px;
      cursor: pointer;
      font-size: 12px;
      color: var(--text-secondary);
    }

    .action-btn:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .action-btn.btn-danger {
      background: var(--danger);
      color: white;
      border-color: var(--danger);
    }

    .action-content {
      background: var(--bg-secondary);
      border-radius: 6px;
      padding: 12px;
    }

    .action-type-icon {
      font-size: 1.2rem;
      margin-right: 8px;
    }

    /* Lista vac√≠a */
    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: var(--text-secondary);
    }

    .empty-state .icon {
      font-size: 3rem;
      margin-bottom: 16px;
      opacity: 0.5;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .container {
        flex-direction: column;
      }
      
      .sidebar {
        width: 100%;
        height: auto;
        border-right: none;
        border-bottom: 1px solid var(--border-secondary);
      }
      
      .form-row {
        flex-direction: column;
      }

      /* Modal responsive */
      #rule-modal > div {
        width: 98% !important;
        margin: 10px;
        max-height: 95vh;
      }

      .modal-grid {
        grid-template-columns: 1fr !important;
        gap: 16px !important;
      }

      .action-header {
        flex-wrap: wrap;
        gap: 8px;
      }

      .action-controls {
        width: 100%;
        justify-content: center;
        margin-left: 0;
      }
    }

    /* Animaciones */
    .fade-in {
      animation: fadeIn 0.3s ease-in;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .checkbox-label {
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: normal;
      margin-bottom: 10px;
    }

    .checkbox-label input[type="checkbox"] {
      width: auto;
      margin: 0;
    }

    .modal-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Sidebar -->
    <div class="sidebar">
      <div class="header">
        <div class="logo">
          <span class="icon">ü§ñ</span>
          <h1>AutoResponder</h1>
        </div>
        <button class="theme-toggle" onclick="toggleTheme()"></button>
      </div>

      <!-- Configuraci√≥n principal -->
      <div class="section">
        <h3>‚öôÔ∏è Configuraci√≥n General</h3>
        
        <div class="form-group">
          <label>Estado del AutoResponder:</label>
          <div style="display: flex; align-items: center; gap: 12px;">
            <label class="checkbox-label">
              <input type="checkbox" id="autoresponder-active" onchange="toggleAutoResponder()">
              <span>Activar AutoResponder</span>
            </label>
            <span id="status-indicator" class="status-indicator status-inactive">
              <span>‚ö´</span> Inactivo
            </span>
          </div>
        </div>

        <div class="form-group">
          <label>Nombre del negocio:</label>
          <input type="text" id="business-name" placeholder="Ej. Mi Restaurante" oninput="saveConfig()">
        </div>

        <div class="form-group">
          <label>Mensaje de bienvenida por defecto:</label>
          <textarea id="default-message" placeholder="¬°Hola! Gracias por contactarnos..." oninput="saveConfig()"></textarea>
        </div>

        <div class="form-group">
          <label>Horario de atenci√≥n:</label>
          <div class="form-row">
            <input type="time" id="start-time" value="08:00" onchange="saveConfig()">
            <input type="time" id="end-time" value="18:00" onchange="saveConfig()">
          </div>
        </div>

        <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" id="only-business-hours" onchange="saveConfig()">
            <span>Solo responder en horario de atenci√≥n</span>
          </label>
        </div>
      </div>

      <!-- Estad√≠sticas r√°pidas -->
      <div class="section">
        <h3>üìä Estad√≠sticas</h3>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
          <div style="text-align: center; padding: 12px; background: var(--bg-tertiary); border-radius: 6px;">
            <div style="font-size: 1.5rem; font-weight: bold; color: var(--text-accent);" id="total-rules">0</div>
            <div style="font-size: 12px; color: var(--text-secondary);">Reglas Activas</div>
          </div>
          <div style="text-align: center; padding: 12px; background: var(--bg-tertiary); border-radius: 6px;">
            <div style="font-size: 1.5rem; font-weight: bold; color: var(--success);" id="responses-today">0</div>
            <div style="font-size: 12px; color: var(--text-secondary);">Respuestas Hoy</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Contenido principal -->
    <div class="main-content">
      <!-- Pesta√±as -->
      <div class="tabs">
        <button class="tab active" onclick="showTab(0)">üìù Reglas</button>
        <button class="tab" onclick="showTab(1)">üìã Plantillas</button>
        <button class="tab" onclick="showTab(2)">‚è∞ Horarios</button>
        <button class="tab" onclick="showTab(3)">üìà Anal√≠ticas</button>
      </div>

      <!-- Contenido de pesta√±as -->
      
      <!-- Pesta√±a Reglas -->
      <div class="tab-content active" id="tab-0">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
          <h2>Reglas de Respuesta Autom√°tica</h2>
          <button onclick="addRule()">‚ûï Nueva Regla</button>
        </div>
        
        <div id="rules-container">
          <div class="empty-state">
            <div class="icon">üìù</div>
            <h3>No hay reglas configuradas</h3>
            <p>Crea tu primera regla para comenzar a automatizar respuestas</p>
            <button onclick="addRule()" style="margin-top: 16px;">Crear Primera Regla</button>
          </div>
        </div>
      </div>

      <!-- Pesta√±a Plantillas -->
      <div class="tab-content" id="tab-1">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
          <h2>Plantillas de Mensajes</h2>
          <button onclick="addTemplate()">‚ûï Nueva Plantilla</button>
        </div>
        
        <div id="templates-container">
          <div class="empty-state">
            <div class="icon">üìã</div>
            <h3>No hay plantillas guardadas</h3>
            <p>Crea plantillas para reutilizar mensajes comunes</p>
            <button onclick="addTemplate()" style="margin-top: 16px;">Crear Primera Plantilla</button>
          </div>
        </div>
      </div>

      <!-- Pesta√±a Horarios -->
      <div class="tab-content" id="tab-2">
        <h2>Gesti√≥n de Horarios</h2>
        <p style="color: var(--text-secondary); margin-bottom: 24px;">Configura horarios espec√≠ficos para diferentes tipos de respuestas</p>
        
        <div id="schedules-container">
          <div class="empty-state">
            <div class="icon">‚è∞</div>
            <h3>Funcionalidad en desarrollo</h3>
            <p>Pronto podr√°s configurar horarios avanzados</p>
          </div>
        </div>
      </div>

      <!-- Pesta√±a Anal√≠ticas -->
      <div class="tab-content" id="tab-3">
        <h2>Anal√≠ticas y Reportes</h2>
        <p style="color: var(--text-secondary); margin-bottom: 24px;">Monitorea el rendimiento de tus respuestas autom√°ticas</p>
        
        <div id="analytics-container">
          <div class="empty-state">
            <div class="icon">üìà</div>
            <h3>Datos insuficientes</h3>
            <p>Activa el AutoResponder para comenzar a generar estad√≠sticas</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal para crear/editar reglas -->
  <div id="rule-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
    <div style="background: var(--bg-secondary); border-radius: 12px; padding: 24px; width: 95%; max-width: 1000px; max-height: 90vh; overflow-y: auto;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h3 id="modal-title">Nueva Regla</h3>
        <button onclick="closeModal()" style="background: transparent; color: var(--text-secondary); padding: 8px;">‚úï</button>
      </div>
      
      <div class="modal-grid">
        <!-- Configuraci√≥n b√°sica -->
        <div>
          <h4 style="margin-bottom: 16px; color: var(--text-accent);">‚öôÔ∏è Configuraci√≥n B√°sica</h4>
          
          <div class="form-group">
            <label>Nombre de la regla:</label>
            <input type="text" id="rule-name" placeholder="Ej. Consulta de horarios">
          </div>
          
          <div class="form-group">
            <label>Palabras clave (separadas por coma):</label>
            <input type="text" id="rule-keywords" placeholder="horario, horarios, atenci√≥n, abierto">
          </div>
          
          <div class="form-group">
            <label>Tipo de coincidencia:</label>
            <select id="rule-match-type">
              <option value="contains">Contiene cualquier palabra</option>
              <option value="exact">Coincidencia exacta</option>
              <option value="starts">Comienza con</option>
            </select>
          </div>
          
          <div class="form-group">
            <label class="checkbox-label">
              <input type="checkbox" id="rule-active" checked>
              <span>Regla activa</span>
            </label>
          </div>
        </div>

        <!-- Acciones -->
        <div>
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
            <h4 style="color: var(--text-accent);">üé¨ Secuencia de Acciones</h4>
            <div>
              <select id="action-type-selector" style="margin-right: 8px;">
                <option value="">Seleccionar acci√≥n...</option>
                <option value="text">üí¨ Enviar Texto</option>
                <option value="image">üñºÔ∏è Enviar Imagen</option>
                <option value="video">üé• Enviar Video</option>
                <option value="audio">üéµ Enviar Audio</option>
                <option value="document">üìÑ Enviar Documento</option>
                <option value="delay">‚è±Ô∏è Tiempo de Espera</option>
                <option value="function">‚ö° Ejecutar Funci√≥n</option>
                <option value="condition">üîÑ Condici√≥n</option>
              </select>
              <button onclick="addAction()" class="btn-small">‚ûï Agregar</button>
            </div>
          </div>
          
          <div id="actions-container" style="max-height: 400px; overflow-y: auto;">
            <div class="empty-state" style="padding: 20px;">
              <div style="font-size: 2rem; margin-bottom: 8px;">üé¨</div>
              <p style="font-size: 14px;">No hay acciones configuradas</p>
              <p style="font-size: 12px; color: var(--text-secondary);">Agrega acciones para crear la secuencia de respuesta</p>
            </div>
          </div>
        </div>
      </div>
      
      <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px; border-top: 1px solid var(--border-secondary); padding-top: 16px;">
        <button onclick="closeModal()" class="btn-small">Cancelar</button>
        <button onclick="saveRule()">Guardar Regla</button>
      </div>
    </div>
  </div>

  <script>
    // Estado global de la aplicaci√≥n
    const state = {
      currentTab: 0,
      autoResponderActive: false,
      config: {
        businessName: '',
        defaultMessage: '',
        startTime: '08:00',
        endTime: '18:00',
        onlyBusinessHours: false
      },
      rules: [],
      templates: [],
      currentEditingRule: null,
      currentEditingActions: []
    };

    // Inicializaci√≥n
    document.addEventListener('DOMContentLoaded', function() {
      loadData();
      renderAll();
      updateStats();
    });

    // Funciones principales
    function toggleTheme() {
      const html = document.documentElement;
      const currentTheme = html.getAttribute('data-theme');
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
      
      html.setAttribute('data-theme', newTheme);
      localStorage.setItem('autoresponder-theme', newTheme);
    }

    function toggleAutoResponder() {
      state.autoResponderActive = document.getElementById('autoresponder-active').checked;
      updateStatusIndicator();
      saveData();
    }

    function updateStatusIndicator() {
      const indicator = document.getElementById('status-indicator');
      if (state.autoResponderActive) {
        indicator.className = 'status-indicator status-active';
        indicator.innerHTML = '<span>üü¢</span> Activo';
      } else {
        indicator.className = 'status-indicator status-inactive';
        indicator.innerHTML = '<span>‚ö´</span> Inactivo';
      }
    }

    function showTab(index) {
      document.querySelectorAll('.tab').forEach((tab, i) => {
        tab.classList.toggle('active', i === index);
      });
      document.querySelectorAll('.tab-content').forEach((content, i) => {
        content.classList.toggle('active', i === index);
      });
      state.currentTab = index;
    }

    function saveConfig() {
      state.config.businessName = document.getElementById('business-name').value;
      state.config.defaultMessage = document.getElementById('default-message').value;
      state.config.startTime = document.getElementById('start-time').value;
      state.config.endTime = document.getElementById('end-time').value;
      state.config.onlyBusinessHours = document.getElementById('only-business-hours').checked;
      saveData();
    }

    function addRule() {
      state.currentEditingRule = null;
      state.currentEditingActions = [];
      document.getElementById('modal-title').textContent = 'Nueva Regla';
      document.getElementById('rule-name').value = '';
      document.getElementById('rule-keywords').value = '';
      document.getElementById('rule-match-type').value = 'contains';
      document.getElementById('rule-active').checked = true;
      document.getElementById('action-type-selector').value = '';
      renderActions();
      document.getElementById('rule-modal').style.display = 'flex';
    }

    function editRule(index) {
      const rule = state.rules[index];
      state.currentEditingRule = index;
      state.currentEditingActions = [...(rule.actions || [])];
      document.getElementById('modal-title').textContent = 'Editar Regla';
      document.getElementById('rule-name').value = rule.name;
      document.getElementById('rule-keywords').value = rule.keywords.join(', ');
      document.getElementById('rule-match-type').value = rule.matchType;
      document.getElementById('rule-active').checked = rule.active;
      document.getElementById('action-type-selector').value = '';
      renderActions();
      document.getElementById('rule-modal').style.display = 'flex';
    }

    function saveRule() {
      const rule = {
        name: document.getElementById('rule-name').value.trim(),
        keywords: document.getElementById('rule-keywords').value.split(',').map(k => k.trim()).filter(k => k),
        matchType: document.getElementById('rule-match-type').value,
        active: document.getElementById('rule-active').checked,
        created: new Date().toISOString(),
        actions: [...(state.currentEditingActions || [])]
      };

      if (!rule.name || !rule.keywords.length) {
        alert('Por favor completa el nombre y las palabras clave');
        return;
      }

      if (state.currentEditingRule !== null) {
        state.rules[state.currentEditingRule] = rule;
      } else {
        state.rules.push(rule);
      }

      closeModal();
      renderRules();
      updateStats();
      saveData();
    }

    function deleteRule(index) {
      if (confirm('¬øEst√°s seguro de eliminar esta regla?')) {
        state.rules.splice(index, 1);
        renderRules();
        updateStats();
        saveData();
      }
    }

    function toggleRule(index) {
      state.rules[index].active = !state.rules[index].active;
      renderRules();
      updateStats();
      saveData();
    }

    function closeModal() {
      document.getElementById('rule-modal').style.display = 'none';
      state.currentEditingActions = [];
    }

    function addTemplate() {
      alert('Funcionalidad de plantillas en desarrollo');
    }

    // Funciones para manejar acciones
    function addAction() {
      const actionType = document.getElementById('action-type-selector').value;
      if (!actionType) {
        alert('Selecciona un tipo de acci√≥n');
        return;
      }

      const action = {
        type: actionType,
        id: Date.now(),
        config: getDefaultActionConfig(actionType)
      };

      if (!state.currentEditingActions) {
        state.currentEditingActions = [];
      }
      
      state.currentEditingActions.push(action);
      renderActions();
      document.getElementById('action-type-selector').value = '';
    }

    function getDefaultActionConfig(type) {
      switch (type) {
        case 'text':
          return { message: '' };
        case 'image':
          return { url: '', caption: '' };
        case 'video':
          return { url: '', caption: '' };
        case 'audio':
          return { url: '' };
        case 'document':
          return { url: '', filename: '' };
        case 'delay':
          return { seconds: 1 };
        case 'function':
          return { functionName: '', parameters: {} };
        case 'condition':
          return { condition: '', trueAction: null, falseAction: null };
        default:
          return {};
      }
    }

    function removeAction(index) {
      if (confirm('¬øEliminar esta acci√≥n?')) {
        state.currentEditingActions.splice(index, 1);
        renderActions();
      }
    }

    function moveAction(index, direction) {
      const actions = state.currentEditingActions;
      const newIndex = index + direction;
      
      if (newIndex >= 0 && newIndex < actions.length) {
        [actions[index], actions[newIndex]] = [actions[newIndex], actions[index]];
        renderActions();
      }
    }

    function updateActionConfig(index, field, value) {
      if (state.currentEditingActions[index]) {
        state.currentEditingActions[index].config[field] = value;
      }
    }

    function renderActions() {
      const container = document.getElementById('actions-container');
      const actions = state.currentEditingActions || [];
      
      if (actions.length === 0) {
        container.innerHTML = `
          <div class="empty-state" style="padding: 20px;">
            <div style="font-size: 2rem; margin-bottom: 8px;">üé¨</div>
            <p style="font-size: 14px;">No hay acciones configuradas</p>
            <p style="font-size: 12px; color: var(--text-secondary);">Agrega acciones para crear la secuencia de respuesta</p>
          </div>
        `;
        return;
      }

      container.innerHTML = actions.map((action, index) => `
        <div class="action-item">
          <div class="action-header">
            <span class="action-number">Paso ${index + 1}</span>
            <span class="action-type-icon">${getActionIcon(action.type)}</span>
            <span style="font-weight: 600;">${getActionTitle(action.type)}</span>
            <div class="action-controls">
              ${index > 0 ? `<button class="action-btn" onclick="moveAction(${index}, -1)" title="Subir">‚Üë</button>` : ''}
              ${index < actions.length - 1 ? `<button class="action-btn" onclick="moveAction(${index}, 1)" title="Bajar">‚Üì</button>` : ''}
              <button class="action-btn btn-danger" onclick="removeAction(${index})" title="Eliminar">√ó</button>
            </div>
          </div>
          <div class="action-content">
            ${renderActionConfig(action, index)}
          </div>
        </div>
      `).join('');
    }

    function getActionIcon(type) {
      const icons = {
        text: 'üí¨',
        image: 'üñºÔ∏è',
        video: 'üé•',
        audio: 'üéµ',
        document: 'üìÑ',
        delay: '‚è±Ô∏è',
        function: '‚ö°',
        condition: 'üîÑ'
      };
      return icons[type] || '‚ùì';
    }

    function getActionTitle(type) {
      const titles = {
        text: 'Enviar Texto',
        image: 'Enviar Imagen',
        video: 'Enviar Video',
        audio: 'Enviar Audio',
        document: 'Enviar Documento',
        delay: 'Tiempo de Espera',
        function: 'Ejecutar Funci√≥n',
        condition: 'Condici√≥n'
      };
      return titles[type] || 'Acci√≥n Desconocida';
    }

    function renderActionConfig(action, index) {
      switch (action.type) {
        case 'text':
          return `
            <div class="form-group">
              <label>Mensaje de texto:</label>
              <textarea placeholder="Escribe el mensaje que se enviar√°..." 
                        oninput="updateActionConfig(${index}, 'message', this.value)">${action.config.message || ''}</textarea>
            </div>
          `;
        
        case 'image':
          return `
            <div class="form-group">
              <label>URL de la imagen:</label>
              <input type="url" placeholder="https://ejemplo.com/imagen.jpg" 
                     value="${action.config.url || ''}"
                     oninput="updateActionConfig(${index}, 'url', this.value)">
            </div>
            <div class="form-group">
              <label>Texto descriptivo (opcional):</label>
              <input type="text" placeholder="Descripci√≥n de la imagen..." 
                     value="${action.config.caption || ''}"
                     oninput="updateActionConfig(${index}, 'caption', this.value)">
            </div>
          `;
        
        case 'video':
          return `
            <div class="form-group">
              <label>URL del video:</label>
              <input type="url" placeholder="https://ejemplo.com/video.mp4" 
                     value="${action.config.url || ''}"
                     oninput="updateActionConfig(${index}, 'url', this.value)">
            </div>
            <div class="form-group">
              <label>Texto descriptivo (opcional):</label>
              <input type="text" placeholder="Descripci√≥n del video..." 
                     value="${action.config.caption || ''}"
                     oninput="updateActionConfig(${index}, 'caption', this.value)">
            </div>
          `;
        
        case 'audio':
          return `
            <div class="form-group">
              <label>URL del audio:</label>
              <input type="url" placeholder="https://ejemplo.com/audio.mp3" 
                     value="${action.config.url || ''}"
                     oninput="updateActionConfig(${index}, 'url', this.value)">
            </div>
          `;
        
        case 'document':
          return `
            <div class="form-group">
              <label>URL del documento:</label>
              <input type="url" placeholder="https://ejemplo.com/documento.pdf" 
                     value="${action.config.url || ''}"
                     oninput="updateActionConfig(${index}, 'url', this.value)">
            </div>
            <div class="form-group">
              <label>Nombre del archivo:</label>
              <input type="text" placeholder="documento.pdf" 
                     value="${action.config.filename || ''}"
                     oninput="updateActionConfig(${index}, 'filename', this.value)">
            </div>
          `;
        
        case 'delay':
          return `
            <div class="form-group">
              <label>Tiempo de espera (segundos):</label>
              <input type="number" min="1" max="300" 
                     value="${action.config.seconds || 1}"
                     oninput="updateActionConfig(${index}, 'seconds', parseInt(this.value))">
              <small style="color: var(--text-secondary); font-size: 12px;">
                El bot esperar√° este tiempo antes de continuar con la siguiente acci√≥n
              </small>
            </div>
          `;
        
        case 'function':
          return `
            <div class="form-group">
              <label>Nombre de la funci√≥n:</label>
              <input type="text" placeholder="nombre_funcion" 
                     value="${action.config.functionName || ''}"
                     oninput="updateActionConfig(${index}, 'functionName', this.value)">
            </div>
            <div class="form-group">
              <label>Par√°metros (JSON):</label>
              <textarea placeholder='{"parametro1": "valor1", "parametro2": "valor2"}' 
                        oninput="updateActionConfig(${index}, 'parameters', this.value)">${JSON.stringify(action.config.parameters || {}, null, 2)}</textarea>
            </div>
          `;
        
        case 'condition':
          return `
            <div class="form-group">
              <label>Condici√≥n a evaluar:</label>
              <input type="text" placeholder="Ej: hora_actual < 18:00" 
                     value="${action.config.condition || ''}"
                     oninput="updateActionConfig(${index}, 'condition', this.value)">
            </div>
            <div style="color: var(--text-secondary); font-size: 12px; margin-top: 8px;">
              <strong>Nota:</strong> Las condiciones permiten ejecutar diferentes acciones seg√∫n el contexto.
              Esta funcionalidad estar√° disponible en una pr√≥xima versi√≥n.
            </div>
          `;
        
        default:
          return `<p style="color: var(--text-secondary);">Configuraci√≥n no disponible para este tipo de acci√≥n.</p>`;
      }
    }

    function renderRuleActions(actions) {
      if (!actions || actions.length === 0) {
        return `
          <div style="background: var(--bg-secondary); padding: 12px; border-radius: 6px; margin-top: 8px;">
            <span style="color: var(--text-secondary); font-style: italic;">No hay acciones configuradas</span>
          </div>
        `;
      }

      return `
        <div style="background: var(--bg-secondary); padding: 12px; border-radius: 6px; margin-top: 8px;">
          <strong style="color: var(--text-primary);">Secuencia de acciones:</strong>
          <div style="margin-top: 8px;">
            ${actions.map((action, index) => `
              <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px; padding: 6px; background: var(--bg-tertiary); border-radius: 4px;">
                <span style="background: linear-gradient(90deg, #e3d7fa, #f7c5da); color: #8038b6; padding: 2px 8px; border-radius: 4px; font-weight: 600; font-size: 12px;">
                  ${index + 1}
                </span>
                <span style="font-size: 14px;">${getActionIcon(action.type)}</span>
                <span style="font-size: 13px; color: var(--text-secondary);">
                  ${getActionTitle(action.type)}
                  ${getActionSummary(action)}
                </span>
              </div>
            `).join('')}
          </div>
        </div>
      `;
    }

    function getActionSummary(action) {
      switch (action.type) {
        case 'text':
          const text = action.config.message || '';
          return text.length > 30 ? `: "${text.substring(0, 30)}..."` : `: "${text}"`;
        case 'image':
          return action.config.caption ? `: ${action.config.caption}` : '';
        case 'video':
          return action.config.caption ? `: ${action.config.caption}` : '';
        case 'document':
          return action.config.filename ? `: ${action.config.filename}` : '';
        case 'delay':
          return `: ${action.config.seconds || 1}s`;
        case 'function':
          return action.config.functionName ? `: ${action.config.functionName}()` : '';
        case 'condition':
          return action.config.condition ? `: ${action.config.condition}` : '';
        default:
          return '';
      }
    }

    function renderRules() {
      const container = document.getElementById('rules-container');
      
      if (state.rules.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="icon">üìù</div>
            <h3>No hay reglas configuradas</h3>
            <p>Crea tu primera regla para comenzar a automatizar respuestas</p>
            <button onclick="addRule()" style="margin-top: 16px;">Crear Primera Regla</button>
          </div>
        `;
        return;
      }

      container.innerHTML = state.rules.map((rule, index) => `
        <div class="rule-item fade-in">
          <div class="rule-header">
            <div>
              <div class="rule-title">${rule.name}</div>
              <div style="font-size: 12px; color: var(--text-secondary); margin-top: 4px;">
                Palabras clave: ${rule.keywords.join(', ')}
              </div>
              <div style="font-size: 12px; color: var(--text-accent); margin-top: 2px;">
                ${(rule.actions || []).length} accion${(rule.actions || []).length !== 1 ? 'es' : ''} configurada${(rule.actions || []).length !== 1 ? 's' : ''}
              </div>
            </div>
            <div style="display: flex; align-items: center; gap: 8px;">
              <span class="status-indicator ${rule.active ? 'status-active' : 'status-inactive'}">
                ${rule.active ? 'üü¢ Activa' : '‚ö´ Inactiva'}
              </span>
              <div class="rule-controls">
                <button class="rule-btn" onclick="toggleRule(${index})" title="${rule.active ? 'Desactivar' : 'Activar'}">
                  ${rule.active ? '‚è∏Ô∏è' : '‚ñ∂Ô∏è'}
                </button>
                <button class="rule-btn" onclick="editRule(${index})" title="Editar">‚úèÔ∏è</button>
                <button class="rule-btn" onclick="deleteRule(${index})" title="Eliminar" style="color: var(--danger);">üóëÔ∏è</button>
              </div>
            </div>
          </div>
          ${renderRuleActions(rule.actions || [])}
        </div>
      `).join('');
    }

    function renderAll() {
      renderRules();
      updateStatusIndicator();
      
      // Cargar configuraci√≥n en los campos
      document.getElementById('business-name').value = state.config.businessName;
      document.getElementById('default-message').value = state.config.defaultMessage;
      document.getElementById('start-time').value = state.config.startTime;
      document.getElementById('end-time').value = state.config.endTime;
      document.getElementById('only-business-hours').checked = state.config.onlyBusinessHours;
      document.getElementById('autoresponder-active').checked = state.autoResponderActive;
    }

    function updateStats() {
      const activeRules = state.rules.filter(rule => rule.active).length;
      document.getElementById('total-rules').textContent = activeRules;
      // Las respuestas de hoy ser√≠an obtenidas de un backend real
      document.getElementById('responses-today').textContent = '0';
    }

    function saveData() {
      localStorage.setItem('autoresponder-data', JSON.stringify({
        config: state.config,
        rules: state.rules,
        templates: state.templates,
        autoResponderActive: state.autoResponderActive
      }));
    }

    function loadData() {
      const saved = localStorage.getItem('autoresponder-data');
      if (saved) {
        const data = JSON.parse(saved);
        state.config = data.config || state.config;
        state.rules = data.rules || [];
        state.templates = data.templates || [];
        state.autoResponderActive = data.autoResponderActive || false;
      }
      
      // Cargar tema
      const savedTheme = localStorage.getItem('autoresponder-theme') || 'light';
      document.documentElement.setAttribute('data-theme', savedTheme);
    }

    // Cerrar modal al hacer clic fuera
    document.getElementById('rule-modal').addEventListener('click', function(e) {
      if (e.target === this) {
        closeModal();
      }
    });
  </script>
</body>
</html>
